---
l1idx: 1
l2idx: 3
l3idx: 1
l4idx: 1
title: "Design Iterations"
permalink: 1_3_1_1.html
summary: "Paths are added to avoid trips through firewalls. Firewalls are added to avoid trips down unwanted paths.  Nobody gets what they *actually* want."
---



## Initial / starting-state design iteration
  - Two workload-hosting sites (sites 1/2)
  - Three VRFs for workload-hosting subnets (network secuirty zones A/B/C)
  - All zones are present at each site
  - A single HA FW pair is present in each DC, with a "leg" in each security zone
  - Inter-data-center connectivity is provisioned for zone "A" only
  - eBGP sessions are established between the firewall and each of the three workload VRFs at each site

This scenario is depicted in the following diagram

<details markdown=block>
<summary markdown=span>Diagram</summary>
[![image](./spont-sym-case-study-1.drawio){:class="img-fluid"}](./pages/1/3%20(spontaneous-symmetry)/spont-sym-case-study-1.drawio){:target="_blank"}
</details>




# Vestigial content follows below




## The Problem to Solve

How do we maximize our flexibility in regards to the deployment of workloads in distinct network security zones at multiple sites, while:

 - Minimizing un-wanted traversal of stateful (firewall) inspection services on intra-zone traffic.
 - Avoiding un-wanted inter-site backhaul for inter-zone, intra-site traffic

## The Status Quo

 - We have multiple network-security zones with hosted workload.
   - Stateful inspection services are present on all inter-zone routing gateways
 - We have multiple sites, with most security-zones present at most sites
 - Inter-zone/inter-site routing is an ugly mess
    - Lots of intra-zone traffic going through firewalls (undesired)
    - Lots of manually maintained high-churn ip prefix-lists duplicated across all routers
       - Any subnet add/delete to any security zone at any site has to be reflected in multiple prefix-lists on multiple devices

## The Result

 - We apply a 99%-uniform set of route-maps to our routers
 - We get optimal pathing for all combinations of inter/intra site/zone flows.
   - Inter-zone traffic always traverses *one* firewall
   - Intra-zone traffic always traverses *no* firewalls
   - No ip prefix-list upkeep  (routes are tagged at origination instead)


### Design Challenges
  - 



## The Status Quo

 - We have multiple network-security zones with hosted workload.
   - Stateful inspection services are present on all inter-zone routing gateways
 - We have multiple sites, with most security-zones present at most sites
 - Inter-zone/inter-site routing is an ugly mess
    - Lots of intra-zone traffic going through firewalls (undesired)
    - Lots of manually maintained high-churn ip prefix-lists duplicated across all routers
       - Any subnet add/delete to any security zone at any site has to be reflected in multiple prefix-lists on multiple devices

## The Result

 - We apply a 99%-uniform set of route-maps to our routers
 - We get optimal pathing for all combinations of inter/intra site/zone flows.
   - Inter-zone traffic always traverses *one* firewall
   - Intra-zone traffic always traverses *no* firewalls
   - No ip prefix-list upkeep  (routes are tagged at origination instead)