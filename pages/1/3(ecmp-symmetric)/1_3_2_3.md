---
l1idx: 1
l2idx: 3
l3idx: 2
l4idx: 3
title: "Nested/Recursive Zones and Sites"
permalink: 1_3_2_3.html
summary: "Are recursively structured 'sub'-zones and/or 'sub'-sites of value?"
---

Having (somehwat) formalized our definitions or "zone" and "site" as well a how represent them on a graph, we consider the innately hierarchical structures of each.

# Sites as a Recursive Concept

We previously established that our concept of "site" in the networks we are contemplating is:
> A region in space (or the set of network nodes in that space) for which we "prefer" paths between nodes "in" that site to remain local to.

This gives us a useful construct to address the the "real world" network desgin incentives to avoid un-needed high-latency hops between network nodes.  It's worth considering, though: 
> are there *other* properties of nodes (or the edges connecting them) that we might want to express a "locality" preference for?  Are those properties inherently recursive in structure?  Is there value to modeling that hierarchical structure in our graph?

Distance/locality *can*, obviously, be sub-divided in a hierarchical manner.   "Degree of resiliency" is another property that we *might* want to take into consideration when selecting paths cross the network/graph; it does *not* suggest an obviously recursive structure, but the related topic of failure domains *does*.  So, the mechanism we're using for expressing the "site"/distance/latency property of an edge might be adaptable to additional properties (some of which may be structured hierarchically) and the real-world phenomena of site/distance/latency definitely *can* be structured hierarchically.

Two key questions suggest themselves at this point:
> How would recurse the "site" property model, if we want to.  And (of course) *do* we want to?

##  Hierarchical relationship of site "0" to other sites

The topology that we've described up to this point uses a distinctly hierarchical model for "site", which it inherits from the real-world topology our model is describing.  Each of our "workload-hosting" sites requires at least one connection to the WAN "site".

That is why we've used "0" as the value for the (parent) "WAN site", and "0.*n*" as the value for the (child) "workload hosting" sites.  The value represents a "stack" of both the parent's identifier ("0") and the child's identifier ("n").   We've further specified that edges connecting two nodes in site 0.*n* are labeled as "0.*n*.0".  This lets us indicate with the edge's label, whether it is connected to two nodes in the same site, or to two nodes in different sites, *and* which sites the nodes are located in.

That structure is trivially extensible if we want to recursively create further subdivisions of the network/graph.  If, for instance, our "workload sites" consisted of multiple "buildings" in a single metro region, we might prefer to have traffic stay local to a building, when possible, rather than bounce between buildings.  (But, that preference might be 10x or 100x less significant than the distinction between "WAN" and site.)


## Creating recursive "site" structures in the graph

In the *WAN > site > building* hierarchy described above, the existing hierarchy is extended by one additional level.  The relation of "WAN" to "site" is the same as that of "site" to "building."  We would extend the labeling convention for the "site" property of edges by appending an additional "section" to the label (representing the "building" identifier, if there is one.)

The following figure depicts a modified version of the reference topology graph, incorporating *two* additional layers of recursion in the "site" property.  Site "0.1" is "split" into two sub-sites  (0.1.1 and 0.1.2), one of which (0.1.1) is further divided into two sub-sub-sites (0.1.1.1 and 0.1.1.2)

[![image](./grphth-13.svg){:class="img-fluid"}](./pages/1/3(ecmp-symmetric)/grphth-13.svg){:target="_blank"}

The preceding figure also illustrates a new rules-of-inference for edges.  Specifically:
> Edges can only connect two nodes at the *same* layer of the site hierarchy or in immediately adjacent layers of the site hierarchy

That rule "makes sense" if the "site hierarchy" really *is* strictly hierarchical. It's certainly easy to imagine scenarios in which "site" (or any other property we want to model this way) might be strictly hiearchical, or might be much "looser" (allowing edges between nodes )






## Observation: Recursion of "zones" and "sites"

It is apparrent from the visual depiction of the graphs that the "transit zone "zone-0" has a parent/child relationship with the "workload-hosting" zones (zones 0.1 - 0.3) and that the "WAN site" (site "0") has a parent/child relationship with the "workload-hosting" sites (sites 0.1 - 0.3)  What, if anything does this suggest about recursively defined sites and/or zones?  Would there be an value in such constructs in the first place?

### Recursive/nested sites structure

As previously discussed, the concept of "site"is useful to us in this context specifically because of the functional limitations of firewalls and other devices acting as "stateful" nodes on the network/graph. We want the selected paths through the graph/network to be "aware" of whether stateful nodes are in the same site or not.  Recursively defined sites, or "sub-sites" are not germane to the use-cases we contemplate here, but *how* they *would* be structured if a relevant use-case presented itself is worth considering.

In order to allow us to represent disjoint networks, we will use "0" as am implicit root-level of the site hierarchy (with a single, implicit, node.)  We will use the following convention in applying site-labels to edges connecting nodes:
- (Implicit) edges from the implicit root node (to "actual" top-level sites' nodes) are labeled as
  - 0.0 If the non-root node has no "children"  (where "*n*" is the top level site)
  - 0.*n* If the non-root-node has "children" (sub-sites), where the non-root-node is the *nth* isolated group of non-root-nodes
- Edges between nodes at the same "site" (at any level) are labelled with the label of site's connection to the parent-site

 - 
Within the graph, we would assign a weight of "1.1.1" to any edges that connect to nodes within the same "sub-site".  This pattern could be extended to an arbitrary degree of recursion (if there were a use-case to take advantage of it.)

The following figure depicts a topology with the "root" site ("0") having three child-sites ("0.1" - "0.3"), each of which have three sub-site/children ("0.*n*.1 - 0.*n*.3"), which in turn, have their own child/sub-sub-sites ("0.*n*.*m*.1 - 0.*n*.*m*.3")   The recursive nature of the sub-site structure is illustrated with dashed circles around each "site", with each parent-level site containing all of each children-sites (and their descendents.)

[![image](./grphth-1.svg){:class="img-fluid"}](./grphth-1.svg){:target="_blank"}

### Recursive security zones

Security zones might also be nested nested using a similar mechanism, although in this case the distinction between child/parent object has a deeper policy significance in the real-world networks that we are modelling.  If we entertain the concept of recursively structured network security zones, it becomes quickly apparent that there is a parent-child relationship between "transit zone" and "workload-hosting zone", and that the a workload-hosting-zone with "child" sub-zones *is* the transit-zone for it child/sub-zones.  As illustrated in the following figures:
