---
l1idx: 1
l2idx: 3
l3idx: 2
l4idx: 3
title: "'Site' Property (Now 'Path Affinity Group')"
permalink: 1_3_2_3.html
summary: "In which we further generalize.  Again."
---

## 'Site' becomes "path affinity group" ("PAG")

We previously defined "site" as a group of nodes on the network that are within the same metropolitan area as each other.  As discussed in the preamble, this is a relatively arbitrary distinction, and one that largely boils down to nodes that are "close enough" that we prefer traffic between them stay within that "site."

As so-far constructed here, the "site" property that we are using is somewhat analogous to round-trip-latency.  (The "closer" an edge is to the root of the "site" hierarchy, the higher the latency of the real-world network connection it represents.)   However, instead of providing a quantitative measurement of latency, it instead collapses the entire range of possible values into two options ("WAN" or "better than WAN.")  This is analagous to the common practice of assigning equal treatment to a *range* of values for use in path selection (in link-state routing protocols.)  

If we decide that "site" in the networks we are contemplating is:
> A region in space (or the set of network nodes *in* that space) for which we "prefer" paths between nodes "in" that site to remain local to.

... that gives us a useful construct to address the the "real world" network design incentives to avoid un-needed high-latency hops between network nodes.  It's worth considering, though: 
> are there *other* properties of nodes (or the edges connecting them) that we might want to express a "locality" preference for?  Are those properties inherently recursive in structure?  Is there value to modeling that hierarchical structure in our graph?

Distance/locality *can*, obviously, be sub-divided in a hierarchical manner.   "Degree of resiliency" is another property that we *might* want to take into consideration when selecting paths cross the network/graph; it does *not* suggest an obviously recursive structure, but the related topic of failure domains *does*.  So, the mechanism we're using for expressing the "site"/distance/latency property of an edge might be adaptable to additional properties (some of which may be structured hierarchically) and the real-world phenomena of site/distance/latency definitely *can* be structured hierarchically.

Rather than "site", we will use the name "path affinity " for this property of the edges in our graph.

Two key questions suggest themselves at this point:
> How would we recurse the "path affinity group" model, if we wanted to.  And (of course) *do* we want to?

##  Hierarchical relationship of PAG "0" to other PAG instances

The topology that we've described up to this point used a distinctly hierarchical model for "site" (now path-affinity group), which it inherits from the real-world topology our model is describing.  Each of our "workload-hosting" PAGs requires at least one connection to the WAN PAG.

That is why we used "0" as the value for the (parent) "WAN" path-affinity-group", and "0.*n*" as the value for the (child) "workload hosting" PAGs.  The value represents a "stack" of both the parent's identifier ("0") and the child's identifier ("n").   We now further specify that edges connecting two nodes in PAG 0.*n* are labeled as "0.*n*.0".  This lets us indicate with the edge's label, whether it is connected to two nodes in the same PAG, or to two nodes in different PAGs, *and* which PAGs the nodes are "located in" (are "part of").

That structure is trivially extensible if we want to recursively create further subdivisions of the network/graph.  If, for instance, our "workload" PAGs consisted of multiple "buildings" in a single metro region, we might prefer to have traffic stay local to a building, when possible, rather than bounce between buildings.  (But, that preference might be 10x or 100x less significant than the distinction between "WAN" and site.)  Likewise, if a given site had a workload cluster with its own overlay-network with routing gateways "connecting" it to the underlay network, similar dynamics could apply.

### Integral PAG Depth (IPD)

> We will use the term **"integral PAG depth"** (IPD) to refer to the number parent/child relationships that exist between a node and the top/root level of the PAG hierarchy.  The "WAN" (PAG 0) contemplated above has an integral edge depth (IPD) of "0"; "metro region PAGs" have an IPD of "1", and "building" PAGs have an IPD of "2."  
> "Integral edge" here is an allusion to the fact that the number of edges with labels that end with a non-zero-integer on the shortest path from any given node to a node in the top/root-level of the site-herarchy tell us how *deep* the given node sits in the PAG hierarchy.

## Creating recursive Path-affinity-group structures in the graph

In the *WAN > site > building* hierarchy described above, the existing hierarchy is extended by one additional level.  The relation of "WAN" to "site" is the same as that of "site" to "building."  We would extend the labeling convention for the "site" property of edges by appending an additional "section" to the label (representing the "building" identifier, if there is one.)

The following figure depicts a modified version of the reference topology graph, incorporating *two* additional layers of recursion in the "site" property.  Site "0.1" (IED=1) is "split" into two sub-sites (0.1.1 and 0.1.2, each with IED=2), one of which (0.1.1) is further divided into two sub-sub-sites (0.1.1.1 and 0.1.1.2, each with IEDs of 3.)

[![image](./grphth-13.svg){:class="img-fluid"}](./pages/1/3(ecmp-symmetric)/grphth-13.svg){:target="_blank"}

The preceding figure also illustrates a new rule of inference for edges.  Specifically:

> Edges can only connect two nodes at the *same* layer of the site hierarchy or in immediately adjacent layers of the site hierarchy

That rule only "makes sense" if the "site hierarchy" really *is* strictly hierarchical. It's certainly easy to imagine scenarios in which "site" (or any other property we want to model this way) might be strictly hiearchical, or might be much "looser" (allowing edges between nodes in non-neighboring levels of the site hierarchy.)

### Better Illustrating the Recursion

The following figure presents an alternate arrangement of the same graph, which more intuitively illustrates the recursive nature of its the site hierarchy.

[![image](./grphth-15.svg){:class="img-fluid"}](./grphth-15.svg){:target="_blank"}















## Edge Labels


Edge labels *also* provide a unique identifier for each fork in the site hierarchy, as well as an indicator of whether the labeled edge is present in one, or in two different levels of the site hierarchy. 

The "site" property of edges is also updated with an implicit "root" at the top of the site hierarchy (also "0").  Similarly to the implicit root of the SPZ hierarchy, this presents on the graph only as a prepended value of "0." to the "site" property of each edge, and exists to provide "headroom" for representation of disjoint site hierarchies.

The implicit root of the site hierarchy is a(n implicit) node, connected to an (implicit) edge that is connected to each site node at the root/top of *our* graph's site hierarchy.

Edge labels are constructed as follows
- Each edge has a "scale" property consisting of a decimal-point delimited sequence of octets in decimal notation.
- The first octet is always "0", representing the nominal/implicit "root" of the SP zone hierarchy.

- Labels are formatted as decimal-point delimited decimal octets, each beginning with "0."
- Each non-zero octet (read left-to-right) represents a level of the site hierarchy
  - E.g.:  In "0.n.m.0", the first "0" represents the implicit root of the site hierarchy, and
    - "n" represents an instance of the graph-local "top"/root level of the site hierarchy (the WAN, in this exercise)
    - "m" represents an instance of the graph-local 2nd-level of the site hierarchy  (one of three workload-hosting sites, in this exercise.)
-  

- All edge labels begin with "0."  ()
  - Edge



...



