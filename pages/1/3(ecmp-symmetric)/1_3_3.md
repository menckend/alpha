---
l1idx: 1
l2idx: 3
l3idx: 3
title: "The Path Selection Mechanism"
permalink: 1_3_3.html
summary: "In which we stop tap-dancing around and solve the problem"
---

# Recapping
We'll use our last depiction of the graph (pictured below) from the previous section as a starting point.

[![image](./grphth-19.svg){:class="img-fluid"}](./pages/1/3(ecmp-symmetric)/grphth-19.svg){:target="_blank"}

If we want symmetrical paths (or at least, "symmetrical enough" that they hit the same stateful nodes) we need a criteria for path selection that chooses the same edges regardless of which of the two nodes is executing the decision.

As discussed in the preamble, the reason that existing forwarding selection mechanisms (BGP ECMP in this case) don't provide that symmetry is that their algorithms operate on hashes of characteristics of the source and destiation of the traffic, and those values are inverted for the two flows.

# Inverting an inversion?

Using our example again (of the src/dst-inverted flow-pair for nodes "14" and "22"), let's (arbitrarily) assume that we wanted our 14->22/22->14 flow-pair to choose "path A" from the three equal-cost paths.

How can we describe path A in a manner that is accurate when evaluated against both of those flows?  The answer lies in the fact that the the security-zones of our two nodes are known in advance.


* 14 -> 22 flow
  * SRC "network-name" = 14
    * In security-zone "0.1"
  * DST "network-name" = 22
    * In security-zone "0.2"
* 22 -> 14 flow
  * SRC "network-name" = 14
    * In security-zone "0.1"
  * DST "network-name" = 22
    * In security-zone "0.2"



In the equal-length paths we have to choose from, we previously noted that:
* PathA  has two stateful nodes in site 0.1  (the same site as one of the endpoints -- node 14)
* PathB has two stateful nodes in site 0.3  (the same site as one of the endpoints -- node 22)
* PathC has one stateful node in the same site as each of the endpoints

